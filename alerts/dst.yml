groups:

###################################################################
# DST
###################################################################

  - name: DST
    rules:

    - alert: DSTPodsRestartingTooFrequently
      expr: rate ( kube_pod_container_status_restarts_total { namespace =~ "dst-prod-app|dst-prod-api|dst-prod-infra"} [10m] ) * 600 >= 2
      for: 30s
      labels:
        owner: profiteroles
        severity: high
      annotations:
        summary: 'Pods are restarting too frequently (during past 10 min). Problem with a few pods: ask around (did anyone deploy anything new?) and alert the team responsible for the service' 

    - alert: DSTPodsRestartingTooFrequently3
      expr: rate ( kube_pod_container_status_restarts_total { namespace =~ "dst-prod-app|dst-prod-api|dst-prod-infra"} [25m] ) * 600 >= 3
      for: 30s
      labels:
        owner: test
        severity: high
      annotations:
        summary: 'Pods are restarting too frequently (during past 25 min). Problem with a few pods: ask around (did anyone deploy anything new?) and alert the team responsible for the service'

    - alert: Openshift_DST
      annotations:
        description: Problem on {{$labels.namespace}} {{$labels.pod}} {{$labels.reason}}.
      expr: sum(
          kube_pod_container_status_waiting_reason { 
          reason=~"CrashLoopBackOff|ErrImagePull|CreateContainerConfigError|ImagePullBackOff|Init:CrashLoopBackOff", namespace=~"dst-prod-app|dst-prod-api|dst-prod-infra"} > 0
        ) by (origin_prometheus, namespace, pod, reason)
      labels:
        severity: high
