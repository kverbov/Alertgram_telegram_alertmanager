groups:

###################################################################
# WSO2
###################################################################

  - name: WSO2
    rules:
    - alert: HeapMemory_warn
      expr: jvm_memory_bytes_used{area="heap",job="wso2jvm"}/jvm_memory_bytes_max{area="heap",job="wso2jvm"}*100 > 75
      for: 30s
      labels:
        severity: warning
      annotations:
        summary: "HeapMemory is > {{ $value }}% on {{$labels.instance}}"


    - alert: HeapMemory_crit
      expr: jvm_memory_bytes_used{area="heap",job="wso2jvm"}/jvm_memory_bytes_max{area="heap",job="wso2jvm"}*100 > 85
      for: 30s
      labels:
        severity: critical
      annotations:
        summary: "HeapMemory is > {{ $value }}% on {{$labels.instance}}"

#    - alert: APP_PROXY_error_warn
#      expr: sum(wso2_integration_proxy_request_count_error_total{env="prod"}-wso2_integration_proxy_request_count_error_total{env="prod"} offset 5m) / sum((max_over_time(wso2_integration_proxy_request_count_total[5m]))-(min_over_time(wso2_integration_proxy_request_count_total[5m]))) by (service_name, instance) > 15
#      for: 30s
#      labels:
#        severity: warning
#      annotations:
#        summary: "Error % > {{ $value }}% on {{$labels.service_name}}"   
# 
#    - alert: APP_API_error_warn
#      expr: sum(wso2_integration_api_request_count_error_total{env="prod"}-wso2_integration_api_request_count_error_total{env="prod"} offset 5m) / sum((max_over_time(wso2_integration_api_request_count_total[5m]))-(min_over_time(wso2_integration_api_request_count_total[5m]))) by (service_name, instance) > 15
#      for: 30s
#      labels:
#        severity: warning
#      annotations:
#        summary: "Error % > {{ $value }}% on {{$labels.service_name}}"   
